#!/usr/bin/python
# -*- coding: utf-8 -*-

import json

poem = """
In man (comma) it was written (comma) are found the elements
and their characteristics (comma) for he passes
from cold to hot (comma) moisture to dryness (stop)
He comes into being and passes out of being
like the minerals (comma) nourishes and reproduces
like the plants (comma) has feeling and life
like animals (stop) His figure resembles the terebinth (semicolon)
his hair (comma) grass (semicolon) veins (comma) arteries (semicolon)
rivers (comma) canals (semicolon)
and his bones (comma) the mountains (stop)
Then the vascular system was discovered (stop)
Pump and pulley replaced wind and mill
sweeping blood down those dusty roads (stop)
And Descartes (comma) the first to admit
he supposed a body to be nothing
but a machine made of earth (stop) Mere clockwork (stop)
He found this a comfort because
you can always wind a machine back up (stop)
The Chimera was a clock in the form of a leviathan (comma)
Memento Mori was the shape of skull (stop)
Spheres and pendants (comma) water droplets and pears (stop)
Milkmaids tugging udders on the hour (stop)
Some kept time using Berthold’s new equation (comma)
some invented the second hand (stop) the silver swan
sits in a stream of glass ripples and gilded leaves (comma)
swallowing silver-plated fish as music plays (stop)
After Descartes’ daughter died (comma)
he took to the sea (stop) They say he went
so mad with grief he remade her
as automaton (stop) A wind-up cog and lever
elegy hidden in the cargo hold (stop)
He said the body is a machine
and he may well be right about that (stop)
But when she was so hot with fever
she could not breathe (comma) and then so suddenly cold (comma)
he held his fingers on her wrist and felt
only his own heart pumping (stop) All the wind
and water of a daughter became a vast meadow
that has no design and no function
and there is no way beyond that stretch of grass (stop)
Grief (comma) the sailors said (comma) is a hex
and contagion and it will draw the wind
down from the sails (stop) It will stopper
in the glass jar sitting like a heart
in the chamber of a mechanical girl
with mechanical glass eyes (stop) On a ship beleaguered
by storm (comma) they ripped open the box
with a crowbar to find the automaton
Descartes called Francine because he missed
saying her name (stop) They threw her into the wake
and his face became a moon in the black
deep (comma) each wave lapping it under (stop)
He supposed that if you thought hard enough
you should be able to understand (comma)
for example (comma) how a stick would refract
in water even if you had never seen a stick
or water or the light of day (stop) By this means (comma)
he said (comma) your mind will be delivered (stop)
If you think hard enough (comma) you can light a fire
in the hearth (stop) Your child can press herself
against your knee and snug her shoulder into yours
as you wind the clock of a girl like and unlike her (comma)
who can walk three remarkable skips and blink
and curtsy politely before ticking down (stop)
It may be there is no wind blowing
blood through the body (comma) but (comma) arm around her (comma)
you feel how she flushes with fiery amazement
as she puts her little hand over her own
cuckooing heart (comma) because this is what we do
when Papa has taken our breath away (stop)

What faculties (comma) when perverted (comma) most degrade the mind (questionmark)
What faculties (comma) when perverted (comma) does it cost most to gratify (questionmark)
I undertook to discover the soul in the body (dash)
I looked in the pineal gland (comma) I looked
in the vena cava (period) I looked in every
perforating arterial branch (period) With the fingers
of my right (comma) I touched the Will and the Ring
of Solomon on the left (period) For a second
I felt sprung (period) Then bereft as ever (period)
Someone used to love me (period) Someone
used to see me (period) If you open a person up (comma)
purple (comma) pulsing (period) It’s in here somewhere (comma) scalpel (comma)
and in and in (period) Let’s walk in the woods (comma)
as we once did (comma) and see if we can find a snail (comma)
its shell covered in symbiotic lichen (period)
When you covered my lichen in yours (comma)
I thought that’s what we wanted (dash)
to be rock and moss and slug and all of it (period)
To be simultaneously thinking of snails (comma)
which are so beautifully stony
and marvelously squished (period)
Wasn’t that what we wanted (questionmark)
I went to your lecture (period) I thought it
best to retrace my steps (period) You were trying
to explain (dash)If I were to put my fingers directly on your brain (period)
I wish you would (comma) how I wish you would
trace the seagull diving towards the water
as a whale rises up (comma) the anchor dropped (comma) the gray
linen slacks (comma) all the polygons of my this and that
jigsawing under your touch (period) Oh yes (comma) let’s
do that (period) Let’s vivisect my brain and see
if it’s in there (period) You have your porcelain man
with the black (dash)lined map of his longing (period)
You have your pointer and your glasses
and your pen (period) I hear you ask the class (comma) What faculties (comma)
having ascendancy (comma) are deaf to reason (questionmark) What faculty (comma)
when large (comma) brightens every object on which we look (questionmark)
I miss you (comma) you know (period) I miss you so (period)

Won’t come alive ever yet or again (questionmark) In the mind of Endtime
it looks like this: shell (comma) volute (comma) Tabriz (comma) eddies (comma) and tides (period)
Flowers wilt (period) When you wake (comma) observe the unmitigated trials and
tribulations of these tossed things (comma) random it seems (period) But in
the endtime (comma) less personhood more ransom (period) Radical sleep in the
Endtime (comma) there is no end of sleep (period) Multiplying the stars was never
easy in Endtime (comma) doing it by themselves (comma) obstinate stars (period)
Self (dash)repairing and learning on the job (period) Write reports (comma) sniff out
plagiarism (comma) fly your planes with a computer (period) Drones inhabit the
Endtime lore (comma) how many kills (period) In Endtime things go static (period) Then still (period)
Switch off “solace (period)” Would you kill another literary form (questionmark) a ransom note
perhaps (comma) saying again: The dead always will be saying too many of us!
Then carry the corpses around (period) In the mind of the Endtime no substitutes
but if you care to try your hand you may gamble all you have to offer and
what would that be (period) A mole might do for you (comma) a burrowing animal “thing” might
do (comma) biding time might do for a time (comma) a night perhaps you have for rhetoric (comma)
before you are released at dawn (period) Recant (comma) reflect (comma) review (comma) reach out (period) We have
met the enemy and it is the psychotic karmic flow of our blowback (period) Privileged
community survives a raging flood (period) Maybe (period) You keep churning and there’s an echo
in the world (period) In the Endtime no need of explanation (period) Need stronger better
experienced cop (questionmark) He’s a baby (period) In the Endtime there are theories of dysfunction (comma)
delicate wheelworks that retread (period) In the mind of the Endtime scotfree isn't
possible (period) No interpretation necessary for your cargo (period) But tax and a
search and a fee and a calibration what it all adds up to (period) Then drop it (period)
Drop it down (comma) send it off (comma) may it disintegrate in peace (period)

This tree has a small LED display
It is glowing and it can show you words
and it can show you pictures and it can melt
from one choice to another and you are looking at it
and it wants you to share the message
but it can’t see that you are the only one around
and that everyone else is hibernating
which you love You are so happy and alone
with the red and yellow lights It’s a nice day
to be in nature and to read up on the very bland ideas
this tree has about how to live This tree says
grow stronger and this tree says fireworks effect
This tree is the saddest prophet in history
but you don’t tell it that You are trying to show it respect
which gets tiresome but then it flashes
a snake at you It’s a kind of LED tree hybrid joke
and you could just kiss it for trying For failing
But it can’t see you and it starts to cry
"""

def process():
    global poem
    poem = poem.lower().replace("\n", " ")
    p = [gram for gram in poem.split() if gram is not ""]
    m = {}
    q = {}
    stems = []
    for i in range(len(p)):
        if i - 2 >= 0:
            a = p[i-2]
            b = p[i-1]
            c = p[i]
            if a not in m:
                m[a] = {}
            if b not in m[a]:
                m[a][b] = []
            m[a][b].append(c)
        if i+1 < len(p):
            if p[i] not in q:
                q[p[i]] = []
            q[p[i]].append(p[i+1])
    return {
        "bigrams": m,
        "monograms": q
    }

#print(json.dumps(process(), sort_keys=True, indent=4, separators=(',', ': ')))
print(json.dumps(process()))
